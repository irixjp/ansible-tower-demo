- name: Initial setup for Ansible Tower
  hosts: all
  gather_facts: no
  connection: local
  max_fail_percentage: 0

  tasks:

    - name: Create tower organization
      tower_organization:
        name: cloud-org
        description: cloud management group
        state: present

    - name: Add tower user
      tower_user:
        username: "{{ item }}"
        password: redhat
        email: tower@example.com
        superuser: no
        state: present
      loop:
        - cloud-admin
        - cloud-user

    - name: Add jdoe to the member role of My Team
      tower_role:
        target_team: "{{ item[0] }}"
        user: "{{ item[1] }}"
        role: "{{ item[2] }}"
        state: present
      loop:
        - [cloud-org, cloud-admin, admin]
        - [cloud-org, cloud-user,  member]
